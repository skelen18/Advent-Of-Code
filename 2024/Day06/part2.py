import time
def inDimensions(dimensions, x, y):
    return 0 <= x < dimensions[0] and 0 <= y < dimensions[1]

def testLoop(x, y, direction, dimensions, obstacles):
    visited = set()
    while (x, y, direction) not in visited:
        visited.add((x, y, direction))
        newX, newY = x + direction[0], y + direction[1]
        if (newX, newY) in obstacles:
            direction = (-direction[1], direction[0]) 
            continue
        if not inDimensions(dimensions, newX, newY):
            return False
        x, y = newX, newY
    return True

def getGuardStartAndDimensions(stringInput):
    posX, posY = 0, 0
    direction = (0, -1)  
    dimensions = (len(stringInput[0]), len(stringInput))
    obstacles = set()

    for y, line in enumerate(stringInput):
        for x, char in enumerate(line):
            if char == '#':
                obstacles.add((x, y))
            elif char == '^':
                posX, posY = x, y
                direction = (0, -1)
            elif char == 'v':
                posX, posY = x, y
                direction = (0, 1)
            elif char == '<':
                posX, posY = x, y
                direction = (-1, 0)
            elif char == '>':
                posX, posY = x, y
                direction = (1, 0)
    return posX, posY, direction, dimensions, obstacles

def countLoopPositions(stringInput):
    posX, posY, direction, dimensions, obstacles = getGuardStartAndDimensions(stringInput)
    visited = set()
    newObstacles = set()

    for y in range(dimensions[1]):
        for x in range(dimensions[0]):
            if (x, y) == (posX, posY) or (x, y) in obstacles:
                continue
            if testLoop(posX, posY, direction, dimensions, obstacles | {(x, y)}):
                newObstacles.add((x, y))
    
    return len(newObstacles)

stringInput = """
..............................#....#..........................................#....................#...........#..##..............
.......#............................#..........#...................................................#...................#........#.
......................................#..................#.................#....................................#...#............#
........#...................#.....................................................................................#...............
.............................#........................#.......................#........#............................#.............
........................##......................................#...............#...................................#.............
...#................#.......................#....#........................#.............................#.........................
..............................................................#............##......#.......#..#.....................#.....#.......
.........................#..#............##.......#.........#....................#.......................##...............#....#..
..............#....................................................................#....#........................................#
.................#............#.....#.....#............................................................#......................#...
.#.................#.................#.....................................#......................................................
...........##..#.......#.........#.#......#..................#.....................#.....#........................................
....................................................#........#........#....................................#......................
........#........#..........#..........................................................#.##.........#..........................#..
...........#............................#............##.............................#...............................#............#
............#......#...............#...........#................................................#.................................
............#..#.#......#............................................................................#.##....#............#.......
................#..............#......#...#........................#.......#.........................#............................
..........................................................................#............#........#......#.#......#.............#...
..........#...#...........................................................#......#..........................................#.....
.......................................#....#..............#...............#....#............#.............#......................
...........#............................................#................................#..............#.........................
..##...............#.................................................................................#.......#.........#.........#
..........#......#......#.........................................#..........#...##.................................#........#....
..........#.......................................................................#..........#...............##.#....#............
....#.............#..#......#..........................................................#......................#...................
.......................................................................#.............##......................#............#.......
............#..#.........#...............................................................................#........................
...............##..#..................#....#....................................................................#......#..........
......#...............................................................................#..#...............#........................
.....#............................................................................#...............#......#........................
#.......................#.........................#...........#....#...#.......#..................................................
.#....................#..............#........................#....................#........###............#.#.#............#.....
.......#...#...................#................................................................................#........##.......
............#.................#.........................................#.....................................#...................
..................#...........#...................................................................................................
......................#.......#...............................#......#...........................#..................#.............
...#..........#......#..........#.....................................................#.....#.................................#...
......#.......#..............................#..............#...............................#...............................#.....
....................................................................#..........#.....#.#...#................................#.....
..............................#...#.....................##.........................................#.#...................#........
........................#....#..............#....................................................................................#
............................#......##...........................#...........#...............................#.....................
.....................................................................................#............................................
#.....................#.................#...#.......##....................#.##.....#.#.......................#....................
....................#............................#.............................................................................#..
........................#.....................................#.............#..............#......................................
...............#....#...................#............................#..#...#.....................................................
.#...........#......#...........##.#...........^.....#........................#..........#.................#......................
...#.##.........#.#......................................#...............#............#......#....................................
.....................................................#......................#.........#.......................#...................
............................................##............#....................#............................#.....................
.............................#.........................##.............#...........................................................
........................................#.............................................................................#...........
.........................................#...............#........#..........................#.#........................#.........
............................................#.................#...............................#...........#.#.......#.............
....................#.............#.........................#..........................#............................#.............
.#.................................#..........#..#.......................................................#........................
..................#..............................................#............##.....#......................................#..#..
.......#...........................................#..................#...........................................................
.#.................................................................#....................................................#.........
...........#.#........#....#...............#.........................................#........................#.........#.........
...............#......#...........#....#....#...............................#..#......#........#.....................#......#.....
.......................................................#.........#.............................#..................#...............
#........................#.........#..........................#................................#...#.....................#.......#
.............................#....................................................................................................
...#..................#....#.............................................................................................#........
..................#........#...............#............................................#..........#..#........................#..
..#...................#..................................#.......#......................#.................................#......#
.........................................#.#......##..........................#.........#..#....................................#.
..........#....#............#.....##....................................................................................#.........
.....#.........##.................................................................................................................
.............................................................................................................#.............#......
...........#.......#..............#...#............#.......................#...#......#.....................................#.....
.......#...................#...........#.....#...#..........................#...........#.........#.............................#.
..............#.....................#..........................................................#..................................
..#............#.................................................#.....#.....................#....#.............................#.
.................#..................................#....#...............................#........................................
.......#..#...........#.#..........##.#.#......................................##.#.....................................#....#....
.....#.#...#......#.............................................................#.........#..#.....................#.............#
.....................................................#..........................................#.......................#.........
........................#....................#................................#......#...........................#......#.........
..........#...........................................................#.....#.#....#...............................#...........#..
........#...............#..............#......#..............................................................#.............#......
...................................................................................................................#..............
.....#..................................................................................##...................#.......#.....#......
...#..#..............#....................................#..#.#..........#.......................................................
#..................#......##.......#..............................................................................................
........................................#....#.........................................................................#..........
#.................................#...................................................#.........#.#...............................
..........................#.....#.#.....................#..........#...................#..#...........................#.....#.....
..........................#..............................#.......#................................................................
.........................#............................#.........#.........#............#............#.#..........................#
.#.#.....................#.....................................#............#.........#..........#.............#.................#
.........#..........................................#.........................................................#...................
..........................................................#.........................#....#...#......#........................#....
.......#.#.........#.............................................#.................#...................#.................#.#......
............#..#........#..#...........#.........................................................#..............#...#.............
..........................#..............#...................................................................#....................
......#.....................#...............#......................................#......#.................#.....................
.........................................................................#.#...........................#..#....#..................
...........#.............................#...#....#...............................................................................
.................................#.....#...............#....#.#.....................................#.........................#...
.#.......#..............#....#..............................................................................#...............##....
.................................#............................#................#...#.........#...................................#
...........#......#.......#..............#.........................#.#.....................................#.......#..............
.....................#....................................#...................#...................................................
...........#...................#.....................................................................................#........#...
..................#...#....................................................................................#..#.........#.........
.............#.................................................#.........#.#.#...............................................#....
..................#............................................#.......................................................#..........
..#......#...........#............................................#...........#............#......#.....................#.........
......#.......................##..........#................................................#...................................#..
.......................................................................#.........#........#....#........................#......#..
..........#...........#...#....................................#.#.............#.#............................#...#.....#.........
.##...............................#......#.....................................................#.........................#......#.
.#.#...#.................................................#......#....................#...........................................#
.........................#..................#.............................#......................................#................
...................................#.......................#..................................#.........#.........................
.........................#...........#...............#........#..................................#...........#..............#.....
...............................#.......................................#.......#.....#.................#....#..............#......
...#...........#.....#................................................#..................#........#.............................#.
..............#........#................................#...#................................#.......#.......#........#........#..
......#....#...................................#............#.........#..#.##..................##....................#......#.....
.....#...........................#................##.............#.#...........................................#..................
#....................................................................#..#......................#..........#.......................
...........#...#..............#.........#....................#.....................#........#.......#...#.#............#..........
.......#..............#........#..##............#...............#.............#.#.......................#.#......#....#...........
....#........#..................#...............#....................#...#...............................#..........#....#..##....
"""

stringInput = stringInput.strip().splitlines()

start_time = time.time()

result = countLoopPositions(stringInput)

end_time = time.time()

print(f"Part 2: {result}")
print(f"Time taken: {round((end_time - start_time) * 1000, 2)} ms")
